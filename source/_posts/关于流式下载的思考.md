---
title: 关于流式下载的思考
date: 2020-08-10 23:56:00
categories: 
tags: []
copyright: true #新增,开启
---

<!--more-->
#### 为什么需要流式下载?
+ 情况1:前端点击下载后,后端生成数据过慢,导致超时
  + 解决1:当然这可以通过调整前后端超时时间
  + 解决2:给用户loading或其他方法展现
  + 解决3:异步,后端接到请求后返回并异步生成,前端轮询状态(这种方式注意控制导出频率和重复利用导出文件,避免用户疯狂点击爆掉服务端)
+ 情况2:数据量过大,服务器内存扛不住数据且导出数据不会出现重复,无保存价值
  + 解决1:使用可暂存硬盘的文件生成工具
  + 其他方式:参考情况1

由于资源及时间问题,我们通常想用流式下载

#### 什么情况下流式下载可行?(此处指的文件需要时时生成,非已存在的文件)
目前根据了解,无需文件头的文件可行(例如txt以及任何可以通过更改txt后缀来变更为想要类型的文件)或者文件头数据固定不变的可行

原因:
+ 如果无需文件头,那么仅需文件体数据,我们完全可以直接通过流式传输给浏览器(设置为流文件类型)让前端按序保存到文件中。
+ 而如果需要文件头的话,文件头中往往包含了文件长度,文件校验码等信息(例如压缩文件就包含了校验码,压缩后大小,压缩前大小,另外压缩文件还需通过文件头标识的文件长度来识别压缩包中有几个文件并解压)
+ 我们流式传输是顺序传输,我们在开始传输时并不知道文件长度,传输结束也无法回头修改文件头(如果前端有某些操作配合除外),所以流式传输在该种情况下不可行

ps:提示下,excel有行数限制。而且10W行以上的excel就已经不适合查看了,打开速度已经影响用户体验。所以大量数据的话谨慎用excel